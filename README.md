# СКУД - Система Контроля и Управления Доступом

Прототип системы контроля и управления доступом (СКУД) на Python с возможностями обнаружения и распознавания лиц в реальном времени.

> **О проекте**: Данный прототип СКУД был разработан в рамках производственной практики и получил одобрение профильного специалиста для дальнейшего развития. Система демонстрирует современные подходы к контролю доступа с использованием технологий компьютерного зрения.

## Возможности

- **Видеонаблюдение в реальном времени**: Мониторинг нескольких камер одновременно
- **Обнаружение и распознавание лиц**: Автоматическое обнаружение лиц с использованием модели YuNet
- **Управление пользователями**: Добавление, управление и аутентификация пользователей по фотографиям
- **Контроль доступа**: Правила доступа к помещениям и разрешения
- **Интеграция с базой данных**: SQLite для хранения данных пользователей, логов доступа и системных событий
- **Графический интерфейс**: Удобный интерфейс на базе Tkinter для управления системой
- **Автоматические зависимости**: Самостоятельная установка необходимых пакетов при первом запуске

## Требования

- Python 3.7+
- Веб-камера или IP-камера
- Windows/Linux/macOS

## Установка

1. **Клонируйте репозиторий:**
   ```bash
   git clone https://github.com/yourusername/camera-surveillance-system.git
   cd camera-surveillance-system
   ```

2. **Запустите приложение:**
   ```bash
   python camera.py
   ```

   Приложение автоматически установит необходимые зависимости при первом запуске:
   - OpenCV (opencv-contrib-python)
   - Pillow
   - face_recognition
   - NumPy

## Быстрый старт

1. **Первоначальная настройка**:
   ```bash
   # Скопируйте файлы-примеры для создания рабочих конфигураций
   cp users.json.example users.json
   cp user_names.json.example user_names.json
   cp camera_history.json.example camera_history.json
   cp photos.json.example photos.json
   ```

2. **Первый запуск**: Выполните `python camera.py` - система автоматически установит зависимости

3. **Добавьте пользователей**: Используйте GUI для добавления авторизованных пользователей с их фотографиями

4. **Настройте камеры**: Настройте видеопотоки в файле cameras.json

5. **Установите правила доступа**: Настройте разрешения доступа к помещениям в access_rules.json

6. **Начните мониторинг**: Запустите видеонаблюдение и распознавание лиц в реальном времени

## Файлы конфигурации

- `cameras.json` - Конфигурация камер и RTSP URL
- `access_rules.json` - Разрешения доступа пользователей по помещениям
- `rooms.json` - Определения помещений и настройки
- `users.json` - База данных пользователей с данными аутентификации
- `user_names.json` - Сопоставления идентификации пользователей

## Структура проекта

```
├── camera.py              # Основной файл приложения
├── database.py           # Операции с базой данных и схема
├── face_detection_yunet_2023mar.onnx  # Модель обнаружения лиц
├── cameras.json          # Конфигурация камер
├── access_rules.json     # Правила контроля доступа
├── rooms.json           # Определения помещений
├── users.json           # База данных пользователей
├── database_faces/      # Сохраненные кодировки лиц
├── detected_faces/      # Захваченные изображения лиц
└── user_photos/         # Фотографии профилей пользователей
```

## Использование

### Добавление новых пользователей
1. Запустите приложение
2. Нажмите "Управление пользователями"
3. Добавьте фотографии пользователей и назначьте разрешения
4. Настройте правила доступа к помещениям

### Настройка камер
1. Отредактируйте `cameras.json` для добавления URL ваших камер
2. Поддержка RTSP, HTTP и локальных видеопотоков
3. Настройте параметры записи и обнаружения

### Мониторинг
- Обнаружение и распознавание лиц в реальном времени
- Ведение журнала событий доступа
- Автоматические уведомления о несанкционированном доступе
- Просмотр исторических данных

## Справочник API

### Основные классы

- `AsyncFrameSaver`: Обрабатывает асинхронное сохранение кадров
- `RTSPVideoCapture`: Управляет соединениями RTSP камер
- Операции с базой данных через `database.py`

### Ключевые функции

- Обнаружение лиц с использованием модели YuNet ONNX
- Распознавание лиц с сравнением кодировок
- Аутентификация пользователей и контроль доступа
- Обработка видео в реальном времени

## Схема базы данных

Система использует SQLite с таблицами для:
- Пользователей и аутентификации
- Журналов доступа и событий
- Конфигураций камер
- Системных настроек

## Участие в разработке

1. Сделайте форк репозитория
2. Создайте ветку функции (`git checkout -b feature/new-feature`)
3. Зафиксируйте изменения (`git commit -am 'Добавить новую функцию'`)
4. Отправьте в ветку (`git push origin feature/new-feature`)
5. Создайте Pull Request

## Примечания по безопасности

- Кодировки лиц надежно хранятся в базе данных
- События доступа регистрируются с временными метками
- Фотографии пользователей хранятся локально с соответствующими разрешениями
- Видеопотоки камер используют безопасные RTSP соединения при возможности

## Устранение неполадок

### Распространенные проблемы

1. **Установка OpenCV**: Приложение автоматически управляет установкой OpenCV
2. **Подключение камеры**: Проверьте URL камер в `cameras.json`
3. **Распознавание лиц**: Обеспечьте хорошее освещение и четкие фотографии лиц
4. **Зависимости**: Запускайте с правами администратора при сбоях установки пакетов

### Оптимизация производительности

- Настройте частоту кадров в конфигурации камеры
- Оптимизируйте пороги обнаружения лиц
- Используйте подходящие разрешения видео для вашего оборудования



### Готовая структура проекта:
```
├── camera.py                           # Основной файл приложения
├── database.py                         # Операции с базой данных
├── face_detection_yunet_2023mar.onnx   # Модель обнаружения лиц
├── README.md                           # Документация проекта
├── LICENSE                             # MIT лицензия
├── requirements.txt                    # Зависимости Python
├── .gitignore                          # Git исключения
├── cameras.json                        # Конфигурация камер
├── access_rules.json                   # Правила доступа
├── rooms.json                          # Определения помещений
├── users.json.example                  # Пример базы пользователей
├── user_names.json.example             # Пример имен пользователей
├── camera_history.json.example         # Пример истории камер
├── photos.json.example                 # Пример метаданных фото
├── user_photos/.gitkeep                # Папка для фото пользователей
├── database_faces/.gitkeep             # Папка для кодировок лиц
└── detected_faces/.gitkeep             # Папка для захваченных лиц
```